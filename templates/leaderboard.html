{% extends "base.html" %}

{% block title %}Leaderboard - Yalla{% endblock %}

{% block content %}
<!-- Hero Header -->
<div class="leaderboard-header text-white py-5">
    <div class="container leaderboard-header-content">
        <div class="text-center animate-slide-up">
            <h1 class="display-4 fw-bold mb-3">ğŸ† Community Leaderboard</h1>
            <p class="lead mb-0 opacity-90">Celebrating our top food enthusiasts and reviewers</p>
        </div>
    </div>
</div>

<div class="container py-5">
    {% if users %}
    <!-- Top 3 Reviewers -->
    <div class="mb-5 animate-stagger">
        {% for user in users[:3] %}
        <div class="card shadow-lg top-reviewer-card mb-4 animate-slide-up">
            <div class="card-body p-5">
                <div class="row align-items-center">
                    <!-- Rank Circle -->
                    <div class="col-auto">
                        <div class="leaderboard-rank rank-{{ loop.index }}">
                            {% if loop.index == 1 %}ğŸ¥‡{% elif loop.index == 2 %}ğŸ¥ˆ{% else %}ğŸ¥‰{% endif %}
                            <div class="rank-number">#{{ loop.index }}</div>
                        </div>
                    </div>
                    
                    <!-- Avatar -->
                    <div class="col-auto">
                        <div class="profile-avatar-large">{{ user.username[0].upper() }}</div>
                    </div>
                    
                    <!-- User Info & Stats -->
                    <div class="col">
                        <!-- Username & Badge -->
                        <div class="mb-4">
                            <h3 class="fw-bold mb-2" style="font-size: 24px;">
                                {{ user.username }}
                                {% if user.is_admin %}
                                <span class="badge bg-danger badge-with-tooltip admin-badge">
                                    Admin
                                    <span class="badge-tooltip">This user is an Admin</span>
                                </span>
                                {% else %}
                                <span class="badge badge-with-tooltip user-badge" style="background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); color: white;">
                                    {{ user.get_badge() }}
                                    <span class="badge-tooltip">This user is a {{ user.get_badge() }}</span>
                                </span>
                                {% endif %}
                            </h3>
                        </div>
                        
                        <!-- Stats Row -->
                        <div class="row g-4">
                            <div class="col-md-3">
                                <div class="stat-item">
                                    <div class="stat-label">Reputation</div>
                                    <div class="stat-value">{{ user.reputation_score }}</div>
                                </div>
                            </div>
                            <div class="col-md-3">
                                <div class="stat-item">
                                    <div class="stat-label">Reviews</div>
                                    <div class="stat-value">{{ user.review_count() }}</div>
                                </div>
                            </div>
                            <div class="col-md-3">
                                <div class="stat-item">
                                    <div class="stat-label">Avg Rating</div>
                                    <div class="stat-value">{{ '%.1f'|format(user.avg_rating_given()) }}</div>
                                </div>
                            </div>
                            <div class="col-md-3 d-flex align-items-center justify-content-center">
                                <a href="{{ url_for('profile', username=user.username) }}" class="btn btn-primary btn-lg">View Profile â†’</a>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        {% endfor %}
    </div>
    
    <!-- Other Reviewers Section -->
    {% if users|length > 3 %}
    <div class="mt-5 animate-slide-up">
        <div class="mb-4">
            <h3 class="fw-bold mb-1">ğŸ“Š Other Top Reviewers</h3>
            <p class="text-muted">Discover more community members</p>
        </div>
        
        <!-- Grid Layout -->
        <div class="other-reviewers-grid">
            {% for user in users[3:] %}
            <div class="reviewer-card animate-scale-in" style="animation-delay: {{ loop.index * 0.05 }}s;">
                <!-- Rank Badge -->
                <div class="reviewer-rank-badge">#{{ loop.index + 3 }}</div>
                
                <!-- Avatar -->
                <div class="reviewer-avatar-small mx-auto mb-2">{{ user.username[0].upper() }}</div>
                
                <!-- Username & Badge -->
                <h5 class="reviewer-card-title">{{ user.username }}</h5>
                <div class="mb-3">
                    {% if user.is_admin %}
                    <span class="badge bg-danger badge-with-tooltip admin-badge">
                        Admin
                        <span class="badge-tooltip">This user is an Admin</span>
                    </span>
                    {% else %}
                    <span class="badge bg-light text-dark badge-with-tooltip user-badge">
                        {{ user.get_badge() }}
                        <span class="badge-tooltip">This user is a {{ user.get_badge() }}</span>
                    </span>
                    {% endif %}
                </div>
                
                <!-- Stats -->
                <div class="reviewer-card-stats">
                    <div class="reviewer-card-stat">
                        Reputation
                        <strong>{{ user.reputation_score }}</strong>
                    </div>
                    <div class="reviewer-card-stat">
                        Reviews
                        <strong>{{ user.review_count() }}</strong>
                    </div>
                </div>
                
                <!-- Rating -->
                <div class="rating-small mb-3">
                    {% set rating = user.avg_rating_given() %}
                    {% for i in range(5) %}
                        {% if i < rating %}
                        <span class="star filled">â˜…</span>
                        {% else %}
                        <span class="star">â˜†</span>
                        {% endif %}
                    {% endfor %}
                </div>
                
                <!-- Action Button -->
                <a href="{{ url_for('profile', username=user.username) }}" class="btn btn-outline-primary btn-sm w-100">View Profile</a>
            </div>
            {% endfor %}
        </div>
    </div>
    {% endif %}
    
    {% else %}
    <!-- Empty State -->
    <div class="text-center py-5 animate-slide-up">
        <h2 class="display-5 fw-bold text-muted mb-3">ğŸŒŸ No reviewers yet</h2>
        <p class="text-muted lead mb-4">Be the first to write reviews and earn your spot on the leaderboard!</p>
        <a href="{{ url_for('restaurants') }}" class="btn btn-primary btn-lg">Start Reviewing Restaurants</a>
    </div>
    {% endif %}
</div>
{% endblock %}
