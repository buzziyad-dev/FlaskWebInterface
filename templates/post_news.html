{% extends "base.html" %}

{% block title %}Post News - Yalla Admin{% endblock %}

{% block content %}
<div class="container py-5">
    <div class="row justify-content-center">
        <div class="col-lg-8">
            <div class="card shadow">
                <div class="card-header bg-primary text-white">
                    <h5 class="mb-0">üìù Post News</h5>
                </div>
                <div class="card-body p-4">
                    <form method="POST" novalidate>
                        {{ form.hidden_tag() }}

                        <!-- Title Field -->
                        <div class="mb-4">
                            <label for="title" class="form-label fw-bold">News Title</label>
                            {% if form.title.errors %}
                                {{ form.title(class="form-control is-invalid") }}
                                <div class="invalid-feedback d-block">
                                    {% for error in form.title.errors %}
                                        <small>{{ error }}</small>
                                    {% endfor %}
                                </div>
                            {% else %}
                                {{ form.title(class="form-control", placeholder="Enter news title (5-200 characters)") }}
                                <small class="text-muted">Minimum 5 characters, maximum 200 characters</small>
                            {% endif %}
                        </div>

                        <!-- Content Field with Rich Text Editor -->
                        <div class="mb-4">
                            <label for="content" class="form-label fw-bold">üìù News Content (Rich Editor)</label>
                            <div id="editor-toolbar" class="mb-2 quill-toolbar-dark" style="background: #f8f9fa; border: 1px solid #dee2e6; border-radius: 4px; padding: 10px;">
                                <!-- Text Formatting -->
                                <button type="button" class="btn btn-sm btn-light quill-btn" title="Bold (Ctrl+B)"><strong>B</strong></button>
                                <button type="button" class="btn btn-sm btn-light quill-btn" title="Italic (Ctrl+I)"><em>I</em></button>
                                <button type="button" class="btn btn-sm btn-light quill-btn" title="Underline (Ctrl+U)"><u>U</u></button>
                                <button type="button" class="btn btn-sm btn-light quill-btn" title="Strikethrough">SÃ∂</button>
                                <button type="button" class="btn btn-sm btn-light quill-btn" title="Subscript">X‚ÇÇ</button>
                                <button type="button" class="btn btn-sm btn-light quill-btn" title="Superscript">X¬≤</button>
                                
                                <div class="btn-group btn-group-sm ms-2" role="group">
                                    <input type="color" class="form-control form-control-sm quill-color" style="width: 40px; height: 38px;" title="Text Color">
                                    <input type="color" class="form-control form-control-sm quill-bg" style="width: 40px; height: 38px;" title="Background Color">
                                </div>
                                
                                <!-- Headers -->
                                <select class="form-select form-select-sm d-inline-block ms-2 quill-header" style="width: 120px;" title="Heading">
                                    <option value="">Normal</option>
                                    <option value="1">Heading 1</option>
                                    <option value="2">Heading 2</option>
                                    <option value="3">Heading 3</option>
                                    <option value="4">Heading 4</option>
                                </select>
                                
                                <!-- Font Size -->
                                <select class="form-select form-select-sm d-inline-block ms-2 quill-size" style="width: 100px;" title="Font Size">
                                    <option value="">Default</option>
                                    <option value="small">Small</option>
                                    <option value="large">Large</option>
                                    <option value="huge">Huge</option>
                                </select>
                                
                                <!-- Lists -->
                                <button type="button" class="btn btn-sm btn-light quill-btn ms-2" title="Unordered List">‚Ä¢ List</button>
                                <button type="button" class="btn btn-sm btn-light quill-btn" title="Ordered List">1. List</button>
                                <button type="button" class="btn btn-sm btn-light quill-btn" title="Checklist">‚úì Check</button>
                                
                                <!-- Alignment -->
                                <select class="form-select form-select-sm d-inline-block ms-2 quill-align" style="width: 100px;" title="Alignment">
                                    <option value="">Left</option>
                                    <option value="center">Center</option>
                                    <option value="right">Right</option>
                                    <option value="justify">Justify</option>
                                </select>
                                
                                <!-- Special Elements -->
                                <button type="button" class="btn btn-sm btn-light quill-btn ms-2" title="Quote">" Quote</button>
                                <button type="button" class="btn btn-sm btn-light quill-btn" title="Code Block">{ } Code</button>
                                <button type="button" class="btn btn-sm btn-light quill-btn" title="Insert Link">üîó Link</button>
                                <button type="button" class="btn btn-sm btn-light quill-btn" title="Insert Image">üñºÔ∏è Image</button>
                                
                                <!-- Indentation & Others -->
                                <button type="button" class="btn btn-sm btn-light quill-btn ms-2" title="Increase Indent">‚Üí Indent</button>
                                <button type="button" class="btn btn-sm btn-light quill-btn" title="Decrease Indent">‚Üê Outdent</button>
                                <button type="button" class="btn btn-sm btn-light quill-btn" title="Horizontal Rule">‚Äî‚Äî HR</button>
                                <button type="button" class="btn btn-sm btn-light quill-btn" title="Undo">‚Ü∂ Undo</button>
                                <button type="button" class="btn btn-sm btn-light quill-btn" title="Redo">‚Ü∑ Redo</button>
                                <button type="button" class="btn btn-sm btn-light quill-btn" title="Clear Formatting">‚úï Clear</button>
                            </div>
                            
                            <div id="editor" class="quill-editor-dark" style="height: 350px; background: white; border: 1px solid #dee2e6; border-radius: 4px;"></div>
                            {{ form.content(id="contentInput", type="hidden") }}
                            {% if form.content.errors %}
                            <div class="text-danger small mt-2">
                                {% for error in form.content.errors %}
                                    {{ error }}<br>
                                {% endfor %}
                            </div>
                            {% endif %}
                        </div>

                        <!-- Buttons -->
                        <div class="d-flex gap-2">
                            <button type="submit" class="btn btn-primary fw-bold">
                                <span class="me-2">+</span>Post News
                            </button>
                            <a href="{{ url_for('news') }}" class="btn btn-outline-secondary">Cancel</a>
                        </div>
                    </form>
                </div>
            </div>

            <!-- Info Box -->
            <div class="alert alert-info mt-4" role="alert">
                <h6 class="alert-heading">üí° Tips for posting news</h6>
                <ul class="mb-0 small">
                    <li>Keep titles clear and concise</li>
                    <li>Use the content area to provide detailed information</li>
                    <li>Proofread before posting</li>
                    <li>News posts will be visible to all users immediately</li>
                </ul>
            </div>
        </div>
    </div>
</div>

<style>
/* Dark Mode Styles for Quill Editor */
body.dark-mode #editor-toolbar {
    background: #2a2a2a !important;
    border-color: #444 !important;
}

body.dark-mode #editor-toolbar .quill-btn,
body.dark-mode #editor-toolbar .form-select,
body.dark-mode #editor-toolbar .form-control,
body.dark-mode #editor-toolbar input[type="color"] {
    background-color: #3a3a3a !important;
    border-color: #555 !important;
    color: #e0e0e0 !important;
}

body.dark-mode #editor-toolbar .quill-btn:hover,
body.dark-mode #editor-toolbar .form-select:hover {
    background-color: #4a4a4a !important;
}

body.dark-mode .quill-editor-dark {
    background: #1e1e1e !important;
    border-color: #444 !important;
}

body.dark-mode .quill-editor-dark .ql-editor {
    background: #1e1e1e !important;
    color: #e0e0e0 !important;
}

body.dark-mode .quill-editor-dark .ql-editor.ql-blank::before {
    color: #888 !important;
}

body.dark-mode .quill-editor-dark .ql-toolbar {
    background: transparent !important;
    border: none !important;
}

body.dark-mode .quill-editor-dark .ql-container {
    border: none !important;
}

/* Light mode defaults */
#editor-toolbar {
    transition: background-color 0.3s, border-color 0.3s;
}

#editor-toolbar .quill-btn,
#editor-toolbar .form-select {
    transition: background-color 0.2s;
}

.quill-editor-dark .ql-editor {
    font-size: 16px;
    line-height: 1.6;
}

.quill-editor-dark .ql-editor h1, 
.quill-editor-dark .ql-editor h2, 
.quill-editor-dark .ql-editor h3 {
    margin-bottom: 0.5rem;
}

/* Hide default Quill toolbar - we use custom toolbar */
.ql-toolbar {
    display: none !important;
}
</style>

<script>
document.addEventListener('DOMContentLoaded', function() {
    // Initialize Quill editor with all formatting options
    // Disable auto-generated toolbar since we're using custom toolbar
    const quill = new Quill('#editor', {
        theme: 'bubble',
        placeholder: 'Write your news content here... (minimum 20 characters)',
        modules: {
            toolbar: false
        }
    });

    // Sync Quill content with hidden input on form submit
    const form = document.querySelector('form');
    form.addEventListener('submit', function() {
        const contentInput = document.getElementById('contentInput');
        contentInput.value = quill.root.innerHTML;
    });

    // Load existing content if available
    const contentInput = document.getElementById('contentInput');
    if (contentInput.value) {
        quill.root.innerHTML = contentInput.value;
    }

    // Apply dark mode styles on load if needed
    const isDarkMode = document.getElementById('appBody').classList.contains('dark-mode');
    if (isDarkMode) {
        applyDarkModeToQuill();
    }

    // Listen for dark mode changes
    const darkModeToggle = document.getElementById('darkModeToggle');
    if (darkModeToggle) {
        darkModeToggle.addEventListener('click', function() {
            setTimeout(() => {
                const isNowDark = document.getElementById('appBody').classList.contains('dark-mode');
                if (isNowDark) {
                    applyDarkModeToQuill();
                } else {
                    removeDarkModeFromQuill();
                }
            }, 100);
        });
    }

    function applyDarkModeToQuill() {
        const toolbar = document.getElementById('editor-toolbar');
        const editor = document.getElementById('editor');
        if (toolbar) toolbar.style.background = '#2a2a2a';
        if (editor) {
            editor.style.background = '#1e1e1e';
            const editorContent = editor.querySelector('.ql-editor');
            if (editorContent) {
                editorContent.style.background = '#1e1e1e';
                editorContent.style.color = '#e0e0e0';
            }
        }
    }

    function removeDarkModeFromQuill() {
        const toolbar = document.getElementById('editor-toolbar');
        const editor = document.getElementById('editor');
        if (toolbar) toolbar.style.background = '#f8f9fa';
        if (editor) {
            editor.style.background = 'white';
            const editorContent = editor.querySelector('.ql-editor');
            if (editorContent) {
                editorContent.style.background = 'white';
                editorContent.style.color = '#000';
            }
        }
    }
});
</script>
{% endblock %}
