{% extends "base.html" %}
{% block title %}{{ user.username }} - Yalla{% endblock %}

{% block content %}

<!-- Profile Header -->
<div class="profile-header">
    <div class="profile-header-content container py-5 text-center text-white">
        <div class="profile-picture-display mb-3 animate-slide-up">
            {% if user.profile_picture %}
            <img src="data:image/png;base64,{{ user.profile_picture | b64encode }}" class="rounded-circle" style="width: 150px; height: 150px; object-fit: cover;">
            {% else %}
            <span>{{ user.username[0].upper() }}</span>
            {% endif %}
        </div>
        <h2 class="fw-bold mb-2 animate-slide-up">{{ user.username }}</h2>
        <p class="text-white-50 mb-3 animate-slide-up">Joined {{ user.created_at.strftime('%B %Y') }}</p>

        <!-- Badges -->
        {% if user.custom_badges.all() %}
        <div class="mb-3 animate-slide-up">
            {% for user_badge in user.custom_badges.all() %}
            <span class="badge me-2 mb-2" style="background-color: {{ user_badge.badge.color }}; color: white; font-size: 0.9rem; padding: 0.5rem 1rem;">
                {{ user_badge.badge.name }}
            </span>
            {% endfor %}
        </div>
        {% endif %}

        <!-- Stats -->
        <div class="profile-stats">
            <div class="stat-card animate-slide-up">
                <div class="h3 fw-bold mb-1">{{ user.review_count() }}</div>
                <div class="text-white-50">Reviews</div>
            </div>
            <div class="stat-card animate-slide-up">
                <div class="h3 fw-bold mb-1">{{ user.reputation_score or user.calculate_reputation() }}</div>
                <div class="text-white-50">Reputation</div>
            </div>
            <div class="stat-card animate-slide-up">
                <div class="h6 fw-bold mb-1">{{ user.get_badge() }}</div>
                <div class="text-white-50">Badge</div>
            </div>
        </div>

        {% if is_own_profile %}
        <a href="{{ url_for('edit_profile', username=user.username) }}" class="btn btn-light mt-3 animate-slide-up">Edit Profile</a>
        {% endif %}
    </div>
</div>

<!-- Content -->
<div class="container py-5">
    <!-- Bio -->
    {% if user.bio %}
    <div class="card shadow-sm mb-4 animate-slide-up">
        <div class="card-header bg-primary text-white fw-bold">About</div>
        <div class="card-body">
            <p class="mb-0">{{ user.bio }}</p>
        </div>
    </div>
    {% endif %}

    <!-- Reviews -->
    <h3 class="fw-bold mb-4 animate-slide-up">⭐ Reviews ({{ reviews|length }})</h3>
    {% if reviews %}
    <div class="row">
        {% for review in reviews %}
        <div class="col-md-6 mb-4 animate-slide-up">
            <div class="card h-100">
                <div class="card-body">
                    <h6 class="card-title fw-bold">{{ review.title or 'Untitled Review' }}</h6>
                    <a href="{{ url_for('restaurant_detail', id=review.restaurant.id) }}" class="text-decoration-none text-primary mb-2 d-block">{{ review.restaurant.name }}</a>
                    <div class="rating mb-2">
                        {% for i in range(5) %}
                            {% if i < review.rating %}<span class="star filled">★</span>{% else %}<span class="star">☆</span>{% endif %}
                        {% endfor %}
                    </div>
                    <p class="text-muted small mb-2">{{ review.formatted_date() }}</p>
                    <p class="card-text">{{ review.content }}</p>
                </div>
            </div>
        </div>
        {% endfor %}
    </div>
    {% else %}
    <div class="text-center py-5">
        <h5 class="text-muted">No reviews yet</h5>
    </div>
    {% endif %}
</div>

{% endblock %}
