{% extends "base.html" %}

{% block title %}Post News - Yalla Admin{% endblock %}

{% block content %}
<div class="container py-5">
    <div class="row justify-content-center">
        <div class="col-lg-8">
            <div class="card shadow">
                <div class="card-header bg-primary text-white">
                    <h5 class="mb-0">üìù Post News</h5>
                </div>
                <div class="card-body p-4">
                    <form method="POST" novalidate>
                        {{ form.hidden_tag() }}

                        <!-- Title Field -->
                        <div class="mb-4">
                            <label for="title" class="form-label fw-bold">News Title</label>
                            {% if form.title.errors %}
                                {{ form.title(class="form-control is-invalid") }}
                                <div class="invalid-feedback d-block">
                                    {% for error in form.title.errors %}
                                        <small>{{ error }}</small>
                                    {% endfor %}
                                </div>
                            {% else %}
                                {{ form.title(class="form-control", placeholder="Enter news title (5-200 characters)") }}
                                <small class="text-muted">Minimum 5 characters, maximum 200 characters</small>
                            {% endif %}
                        </div>

                        <!-- Content Field with Rich Text Editor -->
                        <div class="mb-4">
                            <label for="content" class="form-label fw-bold">News Content</label>
                            <div id="editor-toolbar" class="mb-2" style="background: #f8f9fa; border: 1px solid #dee2e6; border-radius: 4px; padding: 10px;">
                                <!-- Text Formatting -->
                                <button class="btn btn-sm btn-light" id="bold" title="Bold (Ctrl+B)"><strong>B</strong></button>
                                <button class="btn btn-sm btn-light" id="italic" title="Italic (Ctrl+I)"><em>I</em></button>
                                <button class="btn btn-sm btn-light" id="underline" title="Underline (Ctrl+U)"><u>U</u></button>
                                <button class="btn btn-sm btn-light" id="strike" title="Strikethrough">SÃ∂</button>
                                
                                <div class="btn-group btn-group-sm ms-2" role="group">
                                    <input type="color" id="color" class="form-control form-control-sm" style="width: 40px; height: 38px;" title="Text Color">
                                    <input type="color" id="background" class="form-control form-control-sm" style="width: 40px; height: 38px;" title="Background Color">
                                </div>
                                
                                <!-- Headers -->
                                <select class="form-select form-select-sm d-inline-block ms-2" id="header" style="width: 120px;" title="Heading">
                                    <option value="">Normal</option>
                                    <option value="1">Heading 1</option>
                                    <option value="2">Heading 2</option>
                                    <option value="3">Heading 3</option>
                                </select>
                                
                                <!-- Lists -->
                                <button class="btn btn-sm btn-light ms-2" id="list" title="Unordered List">‚Ä¢ List</button>
                                <button class="btn btn-sm btn-light" id="ordered" title="Ordered List">1. List</button>
                                
                                <!-- Alignment -->
                                <select class="form-select form-select-sm d-inline-block ms-2" id="align" style="width: 100px;" title="Alignment">
                                    <option value="">Left</option>
                                    <option value="center">Center</option>
                                    <option value="right">Right</option>
                                    <option value="justify">Justify</option>
                                </select>
                                
                                <!-- Special Elements -->
                                <button class="btn btn-sm btn-light ms-2" id="blockquote" title="Quote">" Quote</button>
                                <button class="btn btn-sm btn-light" id="code-block" title="Code Block">{ } Code</button>
                                <button class="btn btn-sm btn-light" id="link" title="Insert Link">üîó Link</button>
                                
                                <!-- Indentation & Others -->
                                <button class="btn btn-sm btn-light ms-2" id="indent" title="Increase Indent">‚Üí Indent</button>
                                <button class="btn btn-sm btn-light" id="outdent" title="Decrease Indent">‚Üê Outdent</button>
                                <button class="btn btn-sm btn-light" id="hr" title="Horizontal Rule">‚Äî‚Äî HR</button>
                                <button class="btn btn-sm btn-light" id="clean" title="Clear Formatting">‚úï Clear</button>
                            </div>
                            
                            <div id="editor" style="height: 300px; background: white; border: 1px solid #dee2e6; border-radius: 4px;"></div>
                            {{ form.content(id="contentInput", type="hidden") }}
                            <small class="text-muted d-block mt-2">Minimum 20 characters, maximum 5000 characters</small>
                            {% if form.content.errors %}
                            <div class="text-danger small mt-2">
                                {% for error in form.content.errors %}
                                    {{ error }}<br>
                                {% endfor %}
                            </div>
                            {% endif %}
                        </div>

                        <!-- Buttons -->
                        <div class="d-flex gap-2">
                            <button type="submit" class="btn btn-primary fw-bold">
                                <span class="me-2">+</span>Post News
                            </button>
                            <a href="{{ url_for('news') }}" class="btn btn-outline-secondary">Cancel</a>
                        </div>
                    </form>
                </div>
            </div>

            <!-- Info Box -->
            <div class="alert alert-info mt-4" role="alert">
                <h6 class="alert-heading">üí° Tips for posting news</h6>
                <ul class="mb-0 small">
                    <li>Keep titles clear and concise</li>
                    <li>Use the content area to provide detailed information</li>
                    <li>Proofread before posting</li>
                    <li>News posts will be visible to all users immediately</li>
                </ul>
            </div>
        </div>
    </div>
</div>

<script>
document.addEventListener('DOMContentLoaded', function() {
    // Initialize Quill editor
    const quill = new Quill('#editor', {
        theme: 'snow',
        placeholder: 'Write your news content here... (minimum 20 characters)',
        modules: {
            toolbar: [
                ['bold', 'italic', 'underline', 'strike'],
                ['blockquote', 'code-block'],
                [{ 'header': 1 }, { 'header': 2 }, { 'header': 3 }],
                [{ 'list': 'ordered'}, { 'list': 'bullet' }],
                [{ 'indent': '-1'}, { 'indent': '+1' }],
                [{ 'align': [] }],
                [{ 'color': [] }, { 'background': [] }],
                ['link'],
                ['clean']
            ]
        }
    });

    // Sync Quill content with hidden input on form submit
    const form = document.querySelector('form');
    form.addEventListener('submit', function() {
        const contentInput = document.getElementById('contentInput');
        contentInput.value = quill.root.innerHTML;
    });

    // Load existing content if available
    const contentInput = document.getElementById('contentInput');
    if (contentInput.value) {
        quill.root.innerHTML = contentInput.value;
    }
});
</script>
{% endblock %}
