{% extends "base.html" %}

{% block title %}Leaderboard - Yalla{% endblock %}

{% block content %}
<!-- Hero Header -->
<div class="leaderboard-hero">
    <div class="leaderboard-hero-content">
        <h1 class="leaderboard-title animate-slide-up">ğŸ† {{ _('Top Reviewers') }}</h1>
        <p class="leaderboard-subtitle animate-slide-up">{{ _('Join the elite community of food critics') }}</p>
    </div>
    <div class="leaderboard-hero-bg"></div>
</div>

<div class="container py-5">
    {% if users %}
    <!-- Podium Section - Top 3 -->
    <div class="leaderboard-podium-section mb-5">
        <div class="leaderboard-podium">
            <!-- 2nd Place (Silver) -->
            {% if users|length >= 2 %}
            <div class="podium-position second-place animate-slide-up" style="animation-delay: 0.1s;">
                <div class="podium-rank-label">{{ _('2nd') }}</div>
                <div class="podium-card" ; display: none>
                    <div class="podium-avatar silver">{{ users[1].username[0].upper() }}</div>
                    <div class="podium-username">{{ users[1].username }}</div>
                    <div class="podium-score">{{ users[1].review_count() }}</div>
                    <div class="podium-medal">ğŸ¥ˆ</div>
                </div>
                <div class="podium-bar" style="height: 140px;"></div>
            </div>
            {% endif %}

            <!-- 1st Place (Gold) -->
            {% if users|length >= 1 %}
            <div class="podium-position first-place animate-slide-up">
                <div class="podium-rank-label">{{ _('1st') }}</div>
                <div class="podium-card">
                    <div class="podium-avatar gold">{{ users[0].username[0].upper() }}</div>
                    <div class="podium-username">{{ users[0].username }}</div>
                    <div class="podium-score">{{ users[0].review_count() }}</div>
                    <div class="podium-medal">ğŸ¥‡</div>
                </div>
                <div class="podium-bar" style="height: 180px;"></div>
            </div>
            {% endif %}

            <!-- 3rd Place (Bronze) -->
            {% if users|length >= 3 %}
            <div class="podium-position third-place animate-slide-up" style="animation-delay: 0.2s;">
                <div class="podium-rank-label">{{ _('3rd') }}</div>
                <div class="podium-card">
                    <div class="podium-avatar bronze">{{ users[2].username[0].upper() }}</div>
                    <div class="podium-username">{{ users[2].username }}</div>
                    <div class="podium-score">{{ users[2].review_count() }}</div>
                    <div class="podium-medal">ğŸ¥‰</div>
                </div>
                <div class="podium-bar" style="height: 110px;"></div>
            </div>
            {% endif %}
        </div>
    </div>

    <!-- Top 3 Details Section -->
    <div class="row mb-5 g-4">
        {% for user in users[:3] %}
        <div class="col-md-4 animate-slide-up" style="animation-delay: {{ loop.index * 0.1 }}s;">
            <div class="top-reviewer-detail-card">
                <div
                    class="detail-card-header {% if loop.index == 1 %}gold{% elif loop.index == 2 %}silver{% else %}bronze{% endif %}">
                    <div class="detail-rank-badge">#{{ loop.index }}</div>
                </div>
                <div class="detail-card-body">
                    <div class="detail-avatar">{{ user.username[0].upper() }}</div>
                    <h4 class="detail-username">{{ user.username }}</h4>

                    {% if user.is_admin %}
                    <span class="badge bg-danger mb-3">{{ _('Admin') }}</span>
                    {% else %}
                    <span class="badge"
                        style="background: linear-gradient(135deg, var(--primary), var(--secondary)); color: white; margin-bottom: 1rem;">{{
                        user.get_badge() }}</span>
                    {% endif %}

                    <div class="detail-stats">
                        <div class="detail-stat">
                            <div class="detail-stat-value">{{ user.review_count() }}</div>
                            <div class="detail-stat-label">{{ _('Reviews') }}</div>
                        </div>
                        <div class="detail-stat">
                            <div class="detail-stat-value">{{ '%.1f'|format(user.avg_rating_given()) }}/5</div>
                            <div class="detail-stat-label">{{ _('Avg Rating') }}</div>
                        </div>
                    </div>

                    <a href="{{ url_for('profile', user_id=user.id) }}" class="btn btn-sm btn-primary w-100 mt-3">{{
                        _('View Profile') }}</a>
                </div>
            </div>
        </div>
        {% endfor %}
    </div>

    <!-- All Reviewers Table -->
    {% if users|length > 3 %}
    <div class="leaderboard-section animate-slide-up">
        <div class="section-header">
            <h3 class="section-title">{{ _('ğŸ“Š All Reviewers') }}</h3>
            <p class="section-subtitle">{{ _('Complete rankings of community members') }}</p>
        </div>

        <div class="leaderboard-table-wrapper">
            <table class="leaderboard-table">
                <thead>
                    <tr>
                        <th class="rank-col">{{ _('Rank') }}</th>
                        <th class="user-col">{{ _('User') }}</th>
                        <th class="stat-col">{{ _('Reputation') }}</th>
                        <th class="stat-col">{{ _('Reviews') }}</th>
                        <th class="stat-col">{{ _('Avg Rating') }}</th>
                        <th class="action-col">{{ _('Action') }}</th>
                    </tr>
                </thead>
                <tbody>
                    {% for user in users %}
                    <tr class="leaderboard-row" style="animation-delay: {{ loop.index * 0.05 }}s;">
                        <td class="rank-cell">
                            <span class="rank-badge">
                                {% if loop.index == 1 %}ğŸ¥‡{% elif loop.index == 2 %}ğŸ¥ˆ{% elif loop.index == 3 %}ğŸ¥‰{%
                                else %}#{{ loop.index }}{% endif %}
                            </span>
                        </td>
                        <td class="user-cell">
                            <div class="user-info">
                                <div class="user-avatar-small">{{ user.username[0].upper() }}</div>
                                <div>
                                    <div class="user-name">{{ user.username }}</div>
                                    {% if user.is_admin %}
                                    <span class="badge bg-danger badge-sm">{{ _('Admin') }}</span>
                                    {% else %}
                                    <span class="badge bg-light text-dark badge-sm">{{ user.get_badge() }}</span>
                                    {% endif %}
                                </div>
                            </div>
                        </td>
                        <td class="stat-cell">
                            <span class="stat-badge reputation">{{ user.reputation_score }}</span>
                        </td>
                        <td class="stat-cell">
                            <span class="stat-badge reviews">{{ user.review_count() }}</span>
                        </td>
                        <td class="stat-cell">
                            <div class="rating-display">
                                {% for i in range(5) %}
                                <span class="star-sm {% if i < user.avg_rating_given() %}filled{% endif %}">â˜…</span>
                                {% endfor %}
                                <span class="rating-value">({{ '%.1f'|format(user.avg_rating_given()) }})</span>
                            </div>
                        </td>
                        <td class="action-cell">
                            <a href="{{ url_for('profile', user_id=user.id) }}"
                                class="btn btn-sm btn-outline-primary">{{ _('Profile') }}</a>
                        </td>
                    </tr>
                    {% endfor %}
                </tbody>
            </table>
        </div>
    </div>
    {% endif %}

    {% else %}
    <!-- Empty State -->
    <div class="leaderboard-empty animate-slide-up">
        <div class="empty-icon">ğŸŒŸ</div>
        <h2 class="empty-title">{{ _('No Reviewers Yet') }}</h2>
        <p class="empty-description">Be the first to write reviews and earn your spot on the leaderboard!</p>
        <a href="{{ url_for('restaurants') }}" class="btn btn-primary btn-lg mt-4">Start Reviewing Restaurants</a>
    </div>
    {% endif %}
</div>
{% endblock %}